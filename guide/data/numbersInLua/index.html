<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="https://www.w3.org/1999/xhtml">
<head>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Cousine&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="icon" type="image/ico" href="/images/favicon.ico" />
  <link rel="shortcut icon" type="image/png" href="/images/favicon.png" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Corona Documentation — Developer Guides | Data/Files/Strings</title>
  <meta name="description" content="Corona lets you build games/apps for all major platforms including iOS, Android, Kindle, Apple TV, Android TV, macOS, and Windows. Get the free toolset!" />
  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/shCoreDefault.css" type="text/css" />
<script src="https://corona-cdn.coronalabs.com/js/docs.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9574984-14', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body>
<div class="header"></div>
<div class="title">
	<span class="titleimg" onclick="window.location='https://coronalabs.com/'"></span>
	<div id="nav">
		<ul>
<li><a href="../../../guide/programming/index.html">Getting Started</a></li>
<li><a href="../../../guide/index.html">Guides</a></li>
<li><a href="../../../api/index.html">API Reference</a></li>
<li><a href="../../../tutorial/index.html">Tutorials</a></li>
<li><a href="../../../plugin/index.html">Plugins</a></li>
<li><a href="../../../native/index.html">Corona Native</a></li>
</ul>

		<!--
		<div id="resources-link"><a href="https://coronalabs.com/resources/">Corona Resources</a></div>
		-->
	</div>
</div>

<div class="SearchBar">
  <form action="https://www.google.com/cse" id="cse-search-box">
  <input type="hidden" name="cx" value="009283852522218786394:g40gqt2m6rq" />
  <input type="hidden" name="ie" value="UTF-8" />
  <input type="text" placeholder="Search" name="q" id="q" autocomplete="off" size="40" />
  <input type="submit" name="sa" value="Search" />
  </form>
</div>
<div id="TOC">
<ul>
<li><a href="#links">Links</a></li>
</ul>
</div>
<div id="breadcrumb">
<a href="https://docs.coronalabs.com">Documentation</a>  ▸  <a href="../../../guide/index.html">Developer Guides</a>  ▸  <a href="../../../guide/data/index.html">Data/Files/Strings</a>
</div>
<p>Numbers in Corona are 64-bit values, interpreted by Lua 5.1 as double-precision IEEE-754 &quot;float&quot;s. This gives our numbers some flexibility, but comes with a few quirks.</p>
<p>NOTE +43.75 = 0x4045 e000 0000 0000 = 0 10000000100 010111100000000000000000‬00000000000000000000000000000000 NOTE -43.75 = 0xc045 e000 0000 0000 = 1 10000000100 010111100000000000000000‬00000000000000000000000000000000</p>
<p>Most of our numbers lie between neighboring powers of 2. For instance, 43.75 follows 32 (2<sup>5</sup>) but comes before 64 (2<sup>6</sup>).</p>
<p>The numbers 43.75 and -43.75 have hexadecimal forms 0x4045e00000000000 and 0xc045e00000000000, apparently quite similar. In fact, the only difference is that the negative number has its highest bit set. And indeed, this &quot;sign bit&quot; is set aside for exactly this purpose.</p>
<p>(The following considers positive numbers, but the analysis is largely the same for negatives.)</p>
<p>Our next 11 bits have pattern 10000000100, or 1028 in decimal. This doesn't seem very helpful, but if we subtract 1023 from it we recover the exponent 5, giving us our interval [2<sup>5</sup>, 2<sup>6</sup>). Exponents are biased in this way to give us the powers of 2 less than 1—1/2, 1/4, and so on—letting us represent ranges from [2<sup>-1022</sup>, 2<sup>-1021</sup>) at the low end all the way up to [2<sup>1023</sup>, 2<sup>1024</sup>).</p>
<p>The remaining 52 bits have bit pattern 0101111 followed by 45 zeroes, or 1,653,665,488,175,104. Dividing this value by 2<sup>52</sup> gives us our relative position: 0.3671875 of the way along the [32, 64) interval, exactly what we obtain from (43.75 - 32) / (64 - 32).</p>
<p>If we divvy this interval up, we get a spacing of (64 - 32) / 2<sup>52</sup> = 2<sup>5</sup> / 2<sup>52</sup> = 2<sup>-47</sup>. This is the &quot;unit of least precision&quot; / &quot;unit in the last place&quot;, or ulp, for this range. Furthermore, turning this idea around tells us we land exactly on an integer every 2<sup>47</sup> steps, starting from 0: 32, 33, 34...</p>
<p>Doing the same thing with [64, 128), we can represent values every 1 / 2<sup>46</sup>th of the way across the range, landing on an integer every 2<sup>46</sup> steps. Notice that our ulp has gotten wider, while our integers are more dense; the &quot;floating point&quot; terminology originates here. IS this last comment playing too loose?</p>
<p>The situation with integers prevails all the way to [2<sup>52</sup>, 2<sup>53</sup>), where we have (2<sup>53</sup> - 2<sup>52</sup>) / 2<sup>52</sup> = 1. In other words, EVERY value in that range is an integer. In [2<sup>53</sup>, 2<sup>54</sup>), our ulp of 2 is now wide enough to miss: 2<sup>53</sup>, 2<sup>53</sup> + 2, etc. Subsequent ranges only get worse, obviously.</p>
<p>Most of the foregoing applies to negative exponents as well. In the range [2<sup>-3</sup>, 2<sup>-2</sup>), we have (2<sup>-2</sup> - 2<sup>-3</sup>) / 2<sup>52</sup> = 2<sup>-55</sup>. The set of representable values less than 1 is HUGE! We will never land on an integer in this region, of course.</p>
<p>With 11 bits, we should have 2048 exponents available to us, but our comments were short by 2. As it happens, patterns 00000000000 and 11111111111 are set aside for a few special cases.</p>
<p>While nestling numbers between powers of 2 represents plenty of numbers, it puts one conspicuous value in an awkward place: 0! Numerically speaking, of course, this is not between any neighboring powers, since its absolute value is always less than any of them.</p>
<p>This is addressed by the all-0s exponent pattern, when the fraction is 0 as well. A useful property is that all bits 0 is itself 0. Curiously, the sign bit remains, so we can also have -0; this usually goes without notice, but can be surprising when printing values.</p>
<p>The all-0s exponent might also be paired with a non-0 fraction, giving us the so-called denormals. This is the [0, 2<sup>-1022</sup>) range, with ulp = 2<sup>-1022</sup> / 2<sup>52</sup> = 4.9406564584124654417656879286822e<sup>-324</sup>.</p>
<p>As mentioned, all-1s exponent patterns also have special meanings.</p>
<p>For starters, with a fraction of 0 we get infinity. If we divide a vanilla number by infinity, we get 0 back; any other arithmetic results in infinity again. <double check a couple cases here> We can introduce this value ourselves by dividing by 0, for instance <code>1 / 0</code> or <code>-1 / 0</code>.</p>
<p>A non-0 fraction will give us &quot;Not a Number&quot;, often abbreviated as NaN or nan. These arise from bogus computations like <code>0 / 0</code> (handy for adding NaNs in code) or where garden-variety numbers are inadequate, such as <code>math.sqrt(-1)</code>. Like infinity, NaN is contagious: any arithmetic with one results in another NaN.</p>
<p>A NaN has the interesting property of not being equal to itself. Code such as <code>x ~= x</code> is used to detect them.</p>
<p>Strictly speaking, we can have 2<sup>52</sup> - 1 different NaNs, though often we only care if a value is one or not. It is in fact quite common to hijack these 52 bits and store some data there when the value isn't being used as a number. LINK?</p>
<p>Now, while 0 is obviously important, the rest often complicate things. For correctness, mathematical libraries must go through all sorts of hoops to account for the various corner cases. This can slow down code appreciably, enough that many compilers offer &quot;fast math&quot; switches to disable the logic altogether.</p>
<p>There are MANY values this scheme is able to represent exactly; with the above details in mind, we can even come up with some ourselves.</p>
<p>However, many if not most numbers we type into our editors will be &quot;careless&quot; and inexact. In this case, en route from text to running program, the number will be rounded toward a truly representable value.</p>
<p>ALSO happens when result of an add, multiply, etc. isn't representable</p>
<p>We have been speaking of &quot;double&quot; precision floats. As the name suggests, there is also a single-precision variety. This is a 32-bit value, with 8 bits of exponent—biased by 127 CHECK THIS!—and 23 devoted to the fraction, with the sign bit as before. These tend to be preferred when memory matters more, such as keeping structures light for cache coherency or when bandwidth is a concern; the obvious downsides are reduced accuracy and numeric range.</p>
<p>NOTE the following is still rough, maybe needs some expansion to emphasize where we see issues in practice, e.g. shimmering on certain corners, especially with larger textures</p>
<p>We see doubles in Lua, and often both varieties in native code. Floating point also shows up in Corona's shaders. &quot;High precision fragment shader&quot; support, for instance, comes into play on mobile platforms, and basically boils down to how many bits the driver grants to our numbers in fragment kernels.</p>
<p>According to the OpenGL ES2 specification, &quot;medium&quot; precision—which is available in both vertex and fragment kernels—must offer at least 10 bits of fraction: 1024-wide ranges. Furthermore, it promises the swath of values from 2<sup>-14</sup> to 2<sup>14</sup>, suggesting 5 bits of exponent with allowances for the aforementioned special cases. Internally, these will probably be 16-bit values.</p>
<p>With &quot;high&quot; precision—only guaranteed in the vertex kernel—we have at least 16 bits fraction: a more generous 65536 slots, plus values from 2<sup>-62</sup> to 2<sup>62</sup>, for 7 bits of exponent.</p>
<p>These sizes are much tighter than their Lua equivalents, especially in medium precision! They arise from various efficiency concerns on mobile. It's quite easy to wander into the ranges where we can only take steps of say 1 / 8 or 1 / 4, which can manifest in choppy visuals. Mitigating these effects is a key challenge in authoring shaders.</p>
<p>Even when we're &quot;not using shaders&quot;, Corona itself is, in the form of a texture lookup followed by a pixel plot. The lookup coordinates are implemented as floats on the shader side, and occasionally we will see rather mysterious behaviors arise as a result. Larger textures might exhibit shimmering, for instance, on certain edges or corners, as the numbers grow close to 1 and get rounded; thus the call for wider sprite sheet padding on large textures.</p>
<p>LOWP seem to be 10-bit denormals? not sure if worth including</p>
<p>Although the specification's guarantees leave room for the special cases, mobile hardware will often go the &quot;fast math&quot; route, only supporting 0 and leaving out denormals, infinity, and NaN.</p>
<p>ANY conclusion, or just &quot;finally, here's some links&quot;?</p>
<div id="links" class="section level3">
<h3>Links</h3>
<p><a href="https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html">first</a></p>
<p><a href="https://floating-point-gui.de">second</a></p>
<p><a href="https://randomascii.wordpress.com/category/floating-point">third</a></p>
<p><a href="https://www.cprogramming.com/tutorial/floating_point/understanding_floating_point_representation.html">fourth</a></p>
<p><a href="https://www.toves.org/books/float">fifth</a></p>
<p><a href="https://blog.demofox.org/2017/11/21/floating-point-precision">sixth</a></p>
<p><a href="https://www.plunk.org/~hatch/rightway.php">seventh</a></p>
<hr>
<div id="footer">
<p class="copyright">
© 2020 Corona Labs Inc. All Rights Reserved.
</p>
<p class="feedback">
Help us help you! If you notice a problem with this page, please report it.
</p>
<p><a class="feedback-button" href="https://coronalabs.com/corona-docs-feedback-form/?page=guide.data.numbersInLua.index&Current+Public+Release+%282018%2E3326%29" target="_blank">Report an Issue</a></p>
</div>
</div>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shCore.js" type="text/javascript"></script>
<script src="https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shAutoloader.js" type="text/javascript"></script>
<script type="text/javascript">
    // Define syntax highlighting scripts.
    // N.B.: As a safeguard, you will need to whitelist the brush in filter-SyntaxHighlighter.py

    SyntaxHighlighter.autoloader(
      ['c#','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushCSharp.js'],
      ['java','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJava.js'],
      ['js','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushJScript.js'],
      ['lua','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushLua.js'],
      ['php','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushPhp.js'],
      ['sql','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushSql.js'],
      ['xml','https://corona-cdn.coronalabs.com/js/SyntaxHighlighter/shBrushXml.js']
    );

    // Set default configurations.
    SyntaxHighlighter.defaults['gutter'] = false; // Disable line numbers.
    SyntaxHighlighter.defaults['toolbar'] = false; // Disable link back to author's site. :(
	SyntaxHighlighter.defaults['quick-code'] = false; // Disable double click feature

    // Perform the highlighting.
    SyntaxHighlighter.all();
</script>
</body>
</html>
